<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Santa</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        select, input, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .admin {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .hidden {
            display: none;
        }
        .success {
            color: green;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        .distribute-btn {
            background-color: #27ae60;
            margin-bottom: 20px;
        }
        .anonymous {
            font-style: italic;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Secret Santa</h1>
        
        <div id="userForm">
            <div class="form-group">
                <label>Select Your Name:</label>
                <select id="userName" required>
                    <option value="">-- Select your name --</option>
                    <!-- Names will be loaded from storage -->
                </select>
            </div>
            
            <div class="form-group">
                <label>Key Word of your gift:</label>
                <input type="text" id="userValue" required placeholder="">
            </div>
            
            <button onclick="submitForm()">Submit</button>
            <p id="successMessage" class="hidden success">Submitted successfully!</p>
        </div>
        
        <div id="adminSection" class="admin hidden">
            <h2>Admin View</h2>
            <button onclick="showAdminData()">View All Submissions</button>
            <button onclick="distributeValues()" class="distribute-btn">ðŸŽ„ Distribute Gifts Randomly ðŸŽ„</button>
            <div id="adminData"></div>
            <div id="distributionResults" class="hidden"></div>
        </div>
    </div>

    <script>
        // Store all submissions
        let submissions = JSON.parse(localStorage.getItem('listSubmissions')) || [];
        // Store the list of names (updated with your specified names)
        let nameList = JSON.parse(localStorage.getItem('nameList')) || 
                      ['Connie', 'Sharon', 'Wilson', 'Miu', 'ChuSum', 'LCH', 'Adrian', 'KA', 'Chick', 'Nataile', 'TMH', 'æœƒé•·', 'Ken', 'Pete'];
        
        // Initialize the name dropdown
        function initNameList() {
            const select = document.getElementById('userName');
            // Clear existing options except the first one
            while (select.options.length > 1) {
                select.remove(1);
            }
            // Add names from nameList
            nameList.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }
        
        // Submit form
        function submitForm() {
            const name = document.getElementById('userName').value;
            const value = document.getElementById('userValue').value.trim();
            
            if (!name || !value) {
                alert('Please select your name and enter a gift suggestion!');
                return;
            }
            
            // Add to submissions
            submissions.push({
                name: name,
                value: value,
                timestamp: new Date().toISOString()
            });
            
            // Save to localStorage
            localStorage.setItem('listSubmissions', JSON.stringify(submissions));
            
            // Show success
            document.getElementById('successMessage').classList.remove('hidden');
            
            // Clear form (keep name selected)
            document.getElementById('userValue').value = '';
            
            // Hide success after 3 seconds
            setTimeout(() => {
                document.getElementById('successMessage').classList.add('hidden');
            }, 3000);
            
            // Show admin section if password is set
            checkAdmin();
        }
        
        // Admin functions
        function checkAdmin() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                document.getElementById('adminSection').classList.remove('hidden');
            }
        }
        
        function showAdminData() {
            const adminData = document.getElementById('adminData');
            adminData.innerHTML = '<h3>All Submissions:</h3>';
            
            if (submissions.length === 0) {
                adminData.innerHTML += '<p>No submissions yet.</p>';
                return;
            }
            
            // Create a table showing only gift suggestions (no names)
            adminData.innerHTML += `
                <table>
                    <tr>
                        <th>No.</th>
                        <th>Gift Suggestion</th>
                        <th>Time Submitted</th>
                    </tr>
                    ${submissions.map((sub, index) => `
                        <tr>
                            <td>${index + 1}</td>
                            <td class="anonymous">${sub.value}</td>
                            <td>${new Date(sub.timestamp).toLocaleTimeString()}</td>
                        </tr>
                    `).join('')}
                </table>
                <p class="anonymous">Note: Participant names are hidden to maintain anonymity</p>
            `;
        }
        
        // Randomly distribute values to names
        function distributeValues() {
            if (submissions.length === 0) {
                alert('No submissions to distribute!');
                return;
            }
            
            if (nameList.length === 0) {
                alert('No names in the list!');
                return;
            }
            
            // Get only the latest submission per person
            const latestSubmissions = {};
            submissions.forEach(sub => {
                latestSubmissions[sub.name] = sub.value;
            });
            
            const valuesToDistribute = Object.values(latestSubmissions);
            const recipients = [...nameList];
            
            // Remove people who already submitted from recipients
            Object.keys(latestSubmissions).forEach(name => {
                const index = recipients.indexOf(name);
                if (index > -1) {
                    recipients.splice(index, 1);
                }
            });
            
            // Shuffle the values
            const shuffledValues = [...valuesToDistribute].sort(() => 0.5 - Math.random());
            
            // Create distribution (each recipient gets one random gift)
            const distribution = {};
            recipients.forEach((recipient, index) => {
                if (index < shuffledValues.length) {
                    distribution[recipient] = [shuffledValues[index]];
                }
            });
            
            // Display results (without showing names)
            const resultsDiv = document.getElementById('distributionResults');
            resultsDiv.innerHTML = '<h3>ðŸŽ… Secret Santa Assignments ðŸŽ…</h3>';
            
            if (Object.keys(distribution).length === 0) {
                resultsDiv.innerHTML += '<p>Everyone has submitted, but no one left to distribute to!</p>';
            } else {
                resultsDiv.innerHTML += `
                    <p>Gifts have been randomly assigned to participants.</p>
                    <p>Please check your private messages for your assigned gift.</p>
                    <div class="anonymous">
                        <p>Admin note: The system has assigned ${Object.keys(distribution).length} gifts to participants.</p>
                    </div>
                `;
                
                // For admin's reference only (hidden by default)
                resultsDiv.innerHTML += `
                    <details style="margin-top: 15px;">
                        <summary>Admin Reference</summary>
                        <table>
                            <tr>
                                <th>Recipient</th>
                                <th>Gift Idea</th>
                            </tr>
                            ${Object.entries(distribution).map(([name, values]) => `
                                <tr>
                                    <td>${name}</td>
                                    <td>${values.join(', ')}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </details>
                `;
            }
            
            resultsDiv.classList.remove('hidden');
        }
        
        // Initialize on load
        window.onload = function() {
            initNameList();
            checkAdmin();
        };
    </script>
</body>
</html>